<!DOCTYPE html>
<html>
<head>
    <title>Prepare Order</title>
</head>
<body>
    <h1>Prepare Order</h1>

    <!-- Display Error or Success Messages -->
    {% if error %}
        Error: {{ error }}</p>
    {% endif %}
    {% if success %}
        Success: {{ success }}</p>
    {% endif %}

    <!-- Search Form -->
    <form action="/prepare_order" method="POST">
        <h2>Search for an Order</h2>
        <label for="username">Search by Client Username:</label>
        <input type="text" id="username" name="username" placeholder="Enter username"><br><br>

        <label for="orderID">Search by Order ID:</label>
        <input type="number" id="orderID" name="orderID" placeholder="Enter Order ID"><br><br>

        <button type="submit">Search</button>
    </form>

    <!-- Display Orders if Found (Client Username Search) -->
    {% if orders %}
        <h2>Orders for Client</h2>
        <table border="1">
            <tr>
                <th>Order ID</th>
                <th>Order Date</th>
                <th>Order Notes</th>
                <th>Select</th>
            </tr>
            {% for order in orders %}
            <tr>
                <td>{{ order.orderID }}</td>
                <td>{{ order.orderDate }}</td>
                <td>{{ order.orderNotes }}</td>
                <td>
                    <form action="/prepare_order" method="POST">
                        <input type="hidden" name="orderID" value="{{ order.orderID }}">
                        <button type="submit">View Details</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>
    {% endif %}

    <!-- Display Order Details if Found (Order ID Search or Selection) -->
    {% if order %}
        <h2>Order Details</h2>
        <p><strong>Order ID:</strong> {{ order.orderID }}</p>
        <p><strong>Order Date:</strong> {{ order.orderDate }}</p>
        <p><strong>Order Notes:</strong> {{ order.orderNotes }}</p>

        <h3>Items in Order</h3>
        <table border="1">
            <tr>
                <th>Item ID</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Current Room</th>
                <th>Current Shelf</th>
                <th>Shelf Description</th>
            </tr>
            {% for item in items %}
            <tr>
                <td>{{ item.ItemID }}</td>
                <td>{{ item.quantityNum }}</td>
                <td>{{ item.status }}</td>
                <td>{{ item.roomNum or 'N/A' }}</td>
                <td>{{ item.shelfNum or 'N/A' }}</td>
                <td>{{ item.shelfDescription or 'N/A' }}</td>
            </tr>
            {% endfor %}
        </table>

        <br>

        <!-- Update Location Form -->
        <form action="/prepare_order" method="POST">
            <input type="hidden" name="orderID" value="{{ order.orderID }}">
            <h2>Update Order Location</h2>
            <label for="roomNumber">Room Number:</label>
            <input type="number" id="roomNumber" name="roomNumber" placeholder="Enter room number" required><br><br>

            <label for="shelfNumber">Shelf Number:</label>
            <input type="number" id="shelfNumber" name="shelfNumber" placeholder="Enter shelf number" required><br><br>

            <button type="submit">Update Location</button>
        </form>
    {% endif %}

    <br>
    <a href="/person">Back to Home</a>
</body>
</html>
